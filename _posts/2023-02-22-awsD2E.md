---
layout: post
author: Bruce Lee
title: AWS D2E
---

## 👨‍🎓 1. AWS D2E<br/><br/>
- 콜드 핫 스토리지
- 오픈서치 데이터 관리 비용
- 데이터 존 : 데이터 활용 관련 구독을 통해 아테나 등 전달 - 출시예정
- 아파치 에어플로우 : DAG 등
- 클린룸
- Glue : 데이터 카탈로그와 ETL, 크롤링 및 메타데이터를 통한 카탈로그화 - 변경사항 별 버전 관리 가능, 아파치 하이브 기반
  - 데이터 소스 들로부터 카탈로그 분류를 하여 데이터 웨어하우스로 전달하기 위한 느낌
  - ETL 에 UI 를 사용한 부분이 있는데 그걸 추가한 경우 코드로 변환가능해서 수정하는게 좋음
  - 데이터 브루는 데이터 프로파일 관련한 시각화 등 제공 (상관관계 등)
  - 글루 스튜디오 노트북 사용 가능
  - 글루 포 레이는 분산 학습 가능
  - 퀄리티를 통해 데이터 품질 관리 가능
- 키네시스 : 데이터 스트림, 파이어 호스, 비디오 스트림 등으로 구성
  - 데이터 스트림은 샤드로 구분 될 수 있다
  - 파이어호스는 Parquet ORC 등 데이터 변환 가능, 중복 필터링 등
- 아테나 : S3 쿼리를 돌린 결과를 소스로 하여 사용 가능
  - JDBC, ODBC 제공
  - 그룹별 권한 정책 지정 및 격리 가능
  - Federated Query : 람다를 통해 온프레미스 또는 클라우드에서 연합 쿼리 가능
  - 쿼리 결과는 setting 에 지정한 s3 에 자동저장됨
  - parquet 형식을 이용해서 비용 절감 가능
  - 해당 데이터 소스들을 바탕으로 sage maker 등 활용 가능
- QuickSight : ML 기반 이상감지 등이 있고 앱 임베드도 지원

## 👨‍🎓 2. AWS CDK<br/><br/>
- S3 데이터 ingestion to SQS , stable diffustion 사용 - 이미지를 text 로 만들어서 sage maker 로 전송 - S3 적재
- cdk 에서 iam role 부여가 메소드로 쉽게 가능
- CDK 는 Cloud formation 과 같이 떠있어서 Cloud formation 과 같다고 생각하면 됨
- 각 언어별로 개발 가능하고 cdk 실행 시 언어 옵션을 주면 됨
- 강점 : 서버리스 모두 가능, 컨테이너도 이제 모두 컨트롤 가능, CDK for Teraform 를 사용하여 CDK 로 던지면 Teraform 으로 바꿔서 던지기 때문에 버전 관리 등이 편함
- SAM 도 계속 발전되고 있음
- Cloud9 추가금 없이 EC2 접속 및 파일전송 등이 편함
- 람다를 도커에서 배포하기 위해서 dockerfile 에 CMD ["classifier.run"] 넣어서 하면 됨

## 👨‍🎓 3. AWS MWAA<br/><br/>
- 이벤트 기반 아키텍처를 구성했을 때 그 FLOW 에 대한 파악을 하기가 힘들 수 있음
  - Choreography : event 흐름으로 워크플로우 파악
  - Ochestration : 이벤트 기반의 워크플로우를 모니터링 관리하기 위해서 Airflow 를 사용 가능
    - 1세대에는 프로그래밍으로 했고 DAG 가 특징
- Airflow 의 대표 사례는 ETL > AI/ML > DevOps 로 관리할 수 있는게 있으나 Devops 까지는 쉽지 않음
- DAG 디렉토리는 파이썬으로 코딩한 Work flow 이다
- 컴포넌트 네개 : 워커/스케쥴러/데이터베이스/웹서비스
- Task 는 오퍼레이터로 만들 수 있는데 DAG 에 추가되는 Job 이며 여러가지 수행 Operator 를 통해 만들 수 있다
  - 어느 DAG 에서 수행할지 지정해주어야 한다
- DAG 는 오브젝트
- copy_data >> clean_data 와 같은 식으로 각 task 의 work flow 를 지정하거나 함수기반으로도 지정은 할 수 있다
- DAG 는 스케쥴링을 할 수 있고 크론탭 형식으로 작성한다
- Worker 의 경우에도 스케일링이 필요하다
- 스케쥴러 워커는 커스터머 VPC, DB 랑 Web server 는 서비스 VPC
- MWAA 의 경우에는 Fargate 기반으로 내부에 크론탭 기반으로 동작을 하기 때문에 Stop 하여 비용을 절감하는 방법은 사용할 수 없다
  - 즉, Worker DB 등 기본 비용이 들기 때문에 한달에 한번 정도 실행되거나 하는 경우에는 Step function 을 사용하는 것이 낫다
  - MWAA 의 경우에는 외부 이벤트 주입 방식이 아니기 때문이다
- Create 버튼을 누르면 시간이 꽤 소요되고 이후에 Web server UI 로 조회할 수 있다
- Code builder (Git 연동) 와 S3 를 이용해 배포 자동화를 할 수 있다
- Step function 의 경우에도 Operator 로 지원한다
- 초기 비용은 워커 기본 1개, 기본 스케쥴러 2개 워커는 25개 스케쥴러는 5개 까지 비용이 늘어나며 기본 DB 비용도 소요된다
- Step function 은 AWS 내부적으로 만든 것이라 AWS 서비스 들과 Integration 이 좀 더 유연하고 효과적임
- Airflow 는 오픈소스 기반으로 만듦